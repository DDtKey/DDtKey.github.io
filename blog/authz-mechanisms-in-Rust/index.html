<!DOCTYPE html>
<html lang="en">
<html class="dark light">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    

    
    
    
    <title>
         Authorization mechanisms in Rust web applications
        
    </title>

        
            <meta property="og:title" content="Authorization mechanisms in Rust web applications" />
        
     

     
         
     

     
         
    

    
    
        <link rel="icon" type="image/png" href=&#x2F;icons&#x2F;favicon-32x32.png />
    

    
    
        <link href=https://ddtkey.com/fonts.css rel="stylesheet" />
    

    
    
        

        
            
            

            <script data-goatcounter="https://ddtkey.goatcounter.com/count" async src="https://ddtkey.com/js/count.js"></script>
            <noscript>
                
                <img src="https://ddtkey.goatcounter.com//count?p=&#x2F;blog&#x2F;authz-mechanisms-in-Rust&#x2F;&t=Authorization mechanisms in Rust web applications">
            </noscript>
        
    


    

    
    <link rel="alternate" type="application/atom+xml" title="DDtKey" href="https://ddtkey.com/atom.xml">


    
    
        <link rel="stylesheet" type="text/css" href=https://ddtkey.com/theme/light.css />
        <link id="darkModeStyle" rel="stylesheet" type="text/css" href="https://ddtkey.com/theme/dark.css" />
    
    
    <!-- Set the correct theme in the script -->
    <script src=https://ddtkey.com/js/themetoggle.js></script>
    
        <script>setTheme(getSavedTheme());</script>
    

    <link rel="stylesheet" type="text/css" media="screen" href=https://ddtkey.com/main.css />

    
</head>



    <link id="syntax_highlight_dark" href=https://ddtkey.com/css/syntax-dark.css rel="stylesheet" />
    <link id="syntax_highlight_light" href=https://ddtkey.com/css/syntax-light.css rel="stylesheet" />
    <script src=https://ddtkey.com/js/syntax-highlight-switch.js defer></script>


<body>
    <div class="content">
        <header>
    <div class="main">
        <a href=https:&#x2F;&#x2F;ddtkey.com>DDtKey</a>

        <div class="socials">
            
            <a rel="me" href="https:&#x2F;&#x2F;github.com&#x2F;ddtkey" class="social">
                <img alt=github src=https://ddtkey.com/social_icons/github.svg>
            </a>
            
            <a rel="me" href="https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;ddtkey" class="social">
                <img alt=linkedin src=https://ddtkey.com/social_icons/linkedin.svg>
            </a>
            
            <a rel="me" href="https:&#x2F;&#x2F;t.me&#x2F;ddtkey" class="social">
                <img alt=telegram src=https://ddtkey.com/social_icons/telegram.svg>
            </a>
            
            <a rel="me" href="mailto:i@ddtkey" class="social">
                <img alt=email src=https://ddtkey.com/social_icons/email.svg>
            </a>
            
            <a rel="me" href="https:&#x2F;&#x2F;twitter.com&#x2F;ddttkey" class="social">
                <img alt=twitter src=https://ddtkey.com/social_icons/x-twitter.svg>
            </a>
            
        </div>
    </div>

    <nav>
        
        <a href=https://ddtkey.com/blog style="margin-left: 0.7em">&#x2F;blog</a>
        
        <a href=https://ddtkey.com/projects style="margin-left: 0.7em">&#x2F;projects</a>
        
        <a href=https://ddtkey.com/about style="margin-left: 0.7em">&#x2F;about</a>
        

        
        <a id="dark-mode-toggle" onclick="toggleTheme(); event.preventDefault();" href="#">
            <img src=https://ddtkey.com/feather/sun.svg id="sun-icon" style="filter: invert(1);" alt="Light" />
            <img src=https://ddtkey.com/feather/moon.svg id="moon-icon" alt="Dark" />
        </a>

        <!-- Inititialize the theme toggle icons -->
        <script>updateItemToggleTheme()</script>
        
    </nav>
</header>


        
        
    

<main>
    <article>
        <div class="title">
            
            

    <div class="page-header">
        Authorization mechanisms in Rust web applications<span class="primary-color" style="font-size: 1.6em">.</span>
    </div>



                <div class="meta">
                    
                        Posted on <time>2021-05-10</time>
                    

                    
                </div>
        </div>

        

        
        
            
                <h1>Table of Contents</h1>
                <ul>
                
                    <li>
                        <a href="https://ddtkey.com/blog/authz-mechanisms-in-Rust/#introduction">Introduction</a>
                        
                            <ul>
                                
                                    <li>
                                        <a href="https://ddtkey.com/blog/authz-mechanisms-in-Rust/#access-control-models">Access Control Models</a>
                                    </li>

                                    
                                
                            </ul>
                        
                    </li>
                
                    <li>
                        <a href="https://ddtkey.com/blog/authz-mechanisms-in-Rust/#what-do-we-have-in-rust-web-frameworks">What do we have in Rust web frameworks?</a>
                        
                            <ul>
                                
                                    <li>
                                        <a href="https://ddtkey.com/blog/authz-mechanisms-in-Rust/#casbin-rs">casbin-rs</a>
                                    </li>

                                    
                                
                                    <li>
                                        <a href="https://ddtkey.com/blog/authz-mechanisms-in-Rust/#actix-web-grants">actix-web-grants</a>
                                    </li>

                                    
                                    <ul>
                                        
                                            <li>
                                                <a href="https://ddtkey.com/blog/authz-mechanisms-in-Rust/#post-scriptum">Post Scriptum</a>
                                            </li>
                                        
                                    </ul>
                                    
                                
                            </ul>
                        
                    </li>
                
                </ul>
            
        

        <section class="body">
            <p align="center">
<img src="/images/posts/authz-in-rust/preview.png"/>
</p>
<h2 id="introduction">Introduction</h2>
<p>To ensure application security, we use mechanisms such as authentication and authorization. I think many of you are familiar with these concepts and in this article we will focus on the concept of authorization and related access control models.</p>
<p align="center">
<img alt="security" width="500" src="/images/posts/authz-in-rust/security.png"/>
</p>
<details markdown="1">
<summary><b><i>Definitions of terms used in the article</i></b></summary>
<p>It's important to understand the difference between authorization and authentication:</p>
<blockquote>
<p><strong><em>Authentication</em></strong> – a process of verifying your identity and proving that you are a user of the system (by means of a password, token or any other form of credentials).</p>
</blockquote>
<blockquote>
<p><strong><em>Authorization</em></strong> - a mechanism whose task is to allow or deny a request for a specific system resource.</p>
</blockquote>
<blockquote>
<p><strong><em>Access subject</em></strong> – a user or process that is requesting access to the resource.</p>
</blockquote>
<blockquote>
<p><strong><em>Access object</em></strong> – on the contrary, it's a resource to which access is requested by the subject.</p>
</blockquote>
<blockquote>
<p><strong><em>Crate</em></strong> – a library or executable (binary) program in Rust.</p>
</blockquote>
</details>
<br/>
<p>The authorization process includes the concept of <strong><em>access control policy</em></strong>, in accordance with which the set of permissible actions of a particular user (access subject) over the system resources (access objects) is determined.</p>
<p>And also the <strong><em>access control model</em></strong> is a general scheme for delimiting access through a user policy, which we choose depending on various factors and system requirements.</p>
<h3 id="access-control-models">Access Control Models</h3>
<p><strong>Let's take a look at the basic access control models:</strong></p>
<ul>
<li><strong>DAC</strong> - <em>Discretionary access-control</em></li>
</ul>
<img alt="Discretionary access-control" width="200" align="right" src="/images/posts/authz-in-rust/dac.png"/>
<p>This paradigm allows users to independently grant the right to any action on their data to other system participants, for which <em>access control lists</em> (<strong>ACL</strong>) are used.</p>
<p>Most often used in cases where users directly own certain resources and can independently decide who to allow interaction with them.</p>
<p>An example would be operating systems or social networks, where people independently change the visibility of their content.</p>
<ul>
<li><strong>MAC</strong> - <em>Mandatory access-control</em></li>
</ul>
<img alt="Discretionary access-control" width="200" align="left" src="/images/posts/authz-in-rust/mac.png"/>
<p>It was developed for government purposes with a focus on application in extremely secure systems (for example, military), where it was most widespread.</p>
<p>Data protection is based on confidentiality labels (level of secrecy or importance), through which the level of access of subjects is checked. As a rule, the rights are issued centrally by the management body.</p>
<p><em>MAC</em> is perhaps one of the most rigorous and secure models, but it comes with the complexity and high cost of implementing and maintaining the infrastructure around it (there are many ways that require careful planning).</p>
<ul>
<li><strong>RBAC</strong> - <em>Role-Based access-control</em></li>
</ul>
<p>The most common and well-known model that fits well with business domains and correlates with job functions. It is a kind of development of <em>DAC</em>, where privileges are grouped into their respective roles.</p>
<p>Each subject can have a list of roles, where the role, in turn, can provide access to a certain list of objects.</p>
<p>It should be noted that in RBAC the <strong>PBAC</strong> (<em>Permission-Based access-control</em>) model is sometimes allocated when a set of actions is allocated for each resource in the system (for example: <code>READ_DOCUMENT</code>,<code>WRITE_DOCUMENT</code>,<code> DELETE_DOCUMENT</code>) and bind it with the subject through the relationship with roles, directly with the user, or a hybrid approach, when the subject can have a role and separate privileges.</p>
<ul>
<li><strong>ABAC</strong> - <em>Attribute-Based access-control</em></li>
</ul>
<p align="center">
<img alt="Discretionary access-control" width="500" src="/images/posts/authz-in-rust/abac.png"/>
</p>
<p>In this approach, it's necessary to maintain special policies that combine the attributes of subjects and objects, and the access decision is provided based on the analysis and comparison of these attributes.</p>
<p>This is the most flexible of the described models with a huge number of possible combinations, which allows making decisions based on such parameters as request time, location, employee position, etc., but requires more detailed planning of policies to prevent unauthorized access.</p>
<p>ABAC requires some mechanism for interpreting policies and some syntactic subset, which can entail execution time (in the case of a dynamic implementation) or compilation (in the case of code generation).</p>
<p>You can read more about some of the models in <a rel="noopener" target="_blank" href="https://cheatsheetseries.owasp.org/cheatsheets/Access_Control_Cheat_Sheet.html#permission-based-access-control">OWASP materials</a> (Open Web Application Security Project) and in <a rel="noopener" target="_blank" href="https://www.ibm.com/docs/en/sig-and-i/10.0.0?topic=planning-access-control-models">IBM documentation</a>.</p>
<p>Access control is a very important part of web applications, since it is necessary to strictly observe the delimitation of access to resources and data (especially personal ones - the protection of which is provided for by legislative aspects), depending on the privileges of users.</p>
<hr />
<h2 id="what-do-we-have-in-rust-web-frameworks">What do we have in Rust web frameworks?</h2>
<p>Typically, to implement anti-tampering mechanisms in popular web frameworks (such as actix-web, Rocket, or tide), <code>Middleware</code>, <code>FromRequest</code>, or <code>Guard</code> (<code>Filter</code> in the case of warp) implementations are used.</p>
<p>That is, in some kind of middleware, where data about the subject and object of access can be extracted from requests. This approach is quite convenient, since it will allow you to delimit areas of responsibility.</p>
<p>It can be both library (in the form of crates), and custom implementations. But at the moment, the preference is often given to own implementations, which is probably due to the small number of production-ready solutions and the specifics of the applied policies in various projects.</p>
<h3 id="casbin-rs"><a rel="noopener" target="_blank" href="https://github.com/casbin/casbin-rs">casbin-rs</a></h3>
<p align="center">
    <a href="https://github.com/casbin/casbin-rs">
        <img content="true" alt="casbin-rs" src="/images/posts/authz-in-rust/casbin.png"/>
    </a>
</p>
<p><a rel="noopener" target="_blank" href="https://github.com/casbin/casbin-rs/commits/master"><img src="https://img.shields.io/github/last-commit/casbin/casbin-rs" alt="GitHub last commit" /></a>
<a rel="noopener" target="_blank" href="https://crates.io/crates/casbin"><img src="https://img.shields.io/crates/v/casbin.svg" alt="Crates.io" /></a>
<a rel="noopener" target="_blank" href="https://crates.io/crates/casbin"><img src="https://img.shields.io/crates/d/casbin" alt="crates.io" /></a>
<a rel="noopener" target="_blank" href="https://docs.rs/casbin"><img src="https://docs.rs/casbin/badge.svg" alt="Docs" /></a>
<a rel="noopener" target="_blank" href="https://github.com/casbin/casbin-rs/actions"><img src="https://github.com/casbin/casbin-rs/workflows/CI/badge.svg" alt="CI" /></a>
<a rel="noopener" target="_blank" href="https://codecov.io/gh/casbin/casbin-rs"><img src="https://codecov.io/gh/casbin/casbin-rs/branch/master/graph/badge.svg" alt="Codecov" /></a>
<a rel="noopener" target="_blank" href="https://gitter.im/casbin/lobby"><img src="https://badges.gitter.im/Join%20Chat.svg" alt="Gitter" /></a>
<a rel="noopener" target="_blank" href="https://forum.casbin.org/"><img src="https://img.shields.io/badge/forum-join-%23cde201" alt="forum" /></a></p>
<p>The most complete production-ready open source solution that I have been able to find is the adaptation of Casbin (<code>casbin-rs</code>), with an impressive number of supported access models (<em>ACL, RBAC, ABAC</em> declared) and the ability to flexibly change policy by changing only the configuration file ...</p>
<p>Casbin uses its own meta-model <em>PERM (Policy, Effect, Request, Matchers)</em> to build an access model, which gives more flexibility, but introduces the cost of its interpretation and validation.</p>
<pre data-lang="ini" class="language-ini z-code"><code class="language-ini" data-lang="ini"><span class="z-source z-genconfig"><span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># Request definition
</span></span><span class="z-storage z-type z-genconfig">[request_definition]
</span><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">r</span> <span class="z-keyword z-operator z-genconfig">=</span></span> sub<span class="z-keyword z-operator z-genconfig">,</span> obj<span class="z-keyword z-operator z-genconfig">,</span> act

<span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># Policy definition
</span></span><span class="z-storage z-type z-genconfig">[policy_definition]
</span><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">p</span> <span class="z-keyword z-operator z-genconfig">=</span></span> sub<span class="z-keyword z-operator z-genconfig">,</span> obj<span class="z-keyword z-operator z-genconfig">,</span> act

<span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># Policy effect
</span></span><span class="z-storage z-type z-genconfig">[policy_effect]
</span><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">e</span> <span class="z-keyword z-operator z-genconfig">=</span></span> <span class="z-meta z-function z-genconfig"><span class="z-entity z-name z-function z-genconfig">some</span>(</span>where (p<span class="z-keyword z-operator z-genconfig">.</span>eft <span class="z-keyword z-operator z-genconfig">=</span><span class="z-keyword z-operator z-genconfig">=</span> allow))

<span class="z-meta z-comment z-genconfig"><span class="z-comment z-line z-number-sign z-genconfig"># Matchers
</span></span><span class="z-storage z-type z-genconfig">[matchers]
</span><span class="z-meta z-param z-genconfig"><span class="z-variable z-parameter z-genconfig">m</span> <span class="z-keyword z-operator z-genconfig">=</span></span> r<span class="z-keyword z-operator z-genconfig">.</span>sub <span class="z-keyword z-operator z-genconfig">=</span><span class="z-keyword z-operator z-genconfig">=</span> p<span class="z-keyword z-operator z-genconfig">.</span>sub &amp;&amp; r<span class="z-keyword z-operator z-genconfig">.</span>obj <span class="z-keyword z-operator z-genconfig">=</span><span class="z-keyword z-operator z-genconfig">=</span> p<span class="z-keyword z-operator z-genconfig">.</span>obj &amp;&amp; r<span class="z-keyword z-operator z-genconfig">.</span>act <span class="z-keyword z-operator z-genconfig">=</span><span class="z-keyword z-operator z-genconfig">=</span> p<span class="z-keyword z-operator z-genconfig">.</span>act
</span></code></pre>
<p>When describing it, you can easily make a mistake, and therefore the <a rel="noopener" target="_blank" href="https://casbin.org/editor/">web editor of models</a> was developed for convenient and correct modification.</p>
<p>The administration of privileges for your system occurs through the description of the policy (in a file or database) corresponding to the PERM model format.</p>
<pre class="z-code"><code><span class="z-text z-plain">p, alice, data1, read
p, bob, data2, write
</span></code></pre>
<p>Unfortunately, this causes a certain duplication of object and subject identifiers and is not obvious at the level of the calling code.</p>
<pre data-lang="rust" class="language-rust z-code"><code class="language-rust" data-lang="rust"><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">casbin<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">prelude<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-keyword z-operator z-arithmetic z-rust">*</span><span class="z-punctuation z-terminator z-rust">;</span>

<span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">tokio</span>::<span class="z-variable z-annotation z-rust">main</span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
async <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">main</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-&gt;</span> <span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
    <span class="z-storage z-type z-rust">let</span> <span class="z-storage z-modifier z-rust">mut</span> e <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">Enforcer<span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>examples/acl_model.conf<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span><span class="z-punctuation z-separator z-rust">,</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>examples/acl_policy.csv<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span>await<span class="z-keyword z-operator z-rust">?</span><span class="z-punctuation z-terminator z-rust">;</span>
    e<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">enable_log</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-constant z-language z-rust">true</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>

    <span class="z-storage z-type z-rust">let</span> sub <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>alice<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span><span class="z-punctuation z-terminator z-rust">;</span> <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> the user that wants to access a resource.
</span>    <span class="z-storage z-type z-rust">let</span> obj <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>data1<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span><span class="z-punctuation z-terminator z-rust">;</span> <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> the resource that is going to be accessed.
</span>    <span class="z-storage z-type z-rust">let</span> act <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>read<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span><span class="z-punctuation z-terminator z-rust">;</span> <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> the operation that the user performs on the resource.
</span>
    <span class="z-keyword z-control z-rust">if</span> <span class="z-storage z-type z-rust">let</span> <span class="z-support z-type z-rust">Ok</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>authorized</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-keyword z-operator z-assignment z-rust">=</span> e<span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">enforce</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>sub<span class="z-punctuation z-separator z-rust">,</span> obj<span class="z-punctuation z-separator z-rust">,</span> act</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
        <span class="z-keyword z-control z-rust">if</span> authorized <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
            <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> permit alice to read data1
</span>        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span> <span class="z-keyword z-control z-rust">else</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
            <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> deny the request
</span>        </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span> <span class="z-keyword z-control z-rust">else</span> <span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
        <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> error occurs
</span>    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span>
</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre>
<p>Such a tool definitely deserves respect. Many thanks to the community for contributing to its development 👏 !</p>
<p>But, as we can see, developers take into account certain nuances and sometimes want to write their own solutions from project to project, since the requirements can be defined initially, and all the flexibility provided by the library may not be needed, and therefore, we can choose a narrower and lighter solution. that meets our requirements.</p>
<p>As it was with me when I started writing a backend in Rust. The PBAC model was enough for me, and based on my experience in developing web applications, in most typical projects, the <em>ACL</em>/<em>RBAC</em> models are enough.</p>
<p>I came up with the idea of implementing my own solution as a separate open source crate: <em>actix-web-grants</em>.</p>
<h3 id="actix-web-grants"><a rel="noopener" target="_blank" href="https://github.com/DDtKey/actix-web-grants">actix-web-grants</a></h3>
<p align="center">
    <a href="https://github.com/DDtKey/actix-web-grants">
        <img content="true" alt="actix-web-grants" src="/images/posts/authz-in-rust/awg.png"/>
    </a>
</p>
<p><a rel="noopener" target="_blank" href="https://github.com/DDtKey/actix-web-grants/actions"><img src="https://github.com/DDtKey/actix-web-grants/workflows/CI/badge.svg" alt="CI" /></a>
<a rel="noopener" target="_blank" href="https://crates.io/crates/actix-web-grants"><img src="https://img.shields.io/crates/d/actix-web-grants" alt="Crates.io Downloads Badge" /></a>
<a rel="noopener" target="_blank" href="https://crates.io/crates/actix-web-grants"><img src="https://img.shields.io/crates/v/actix-web-grants" alt="crates.io" /></a>
<a rel="noopener" target="_blank" href="https://docs.rs/actix-web-grants"><img src="https://docs.rs/actix-web-grants/badge.svg" alt="Documentation" /></a>
<a rel="noopener" target="_blank" href="https://deps.rs/repo/github/DDtKey/actix-web-grants"><img src="https://deps.rs/repo/github/DDtKey/actix-web-grants/status.svg" alt="dependency status" /></a>
<img src="https://img.shields.io/crates/l/actix-web-grants" alt="Apache 2.0 or MIT licensed" /></p>
<p>The main idea of the project is to use built-in middleware to get user privileges from a request and specify the necessary permissions directly on your endpoints.</p>
<p>This is a fairly lightweight crate with simple integration, using which you can at least apply the following models: access lists (ACL), role-based or permission-based access control (<em>RBAC</em>/<em>PBAC</em>).</p>
<p>Thus, we just need to implement the function of obtaining privileges:</p>
<pre data-lang="rust" class="language-rust z-code"><code class="language-rust" data-lang="rust"><span class="z-source z-rust"><span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Sample application with grant protection based on extracting by your custom function
</span><span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">actix_web</span>::<span class="z-variable z-annotation z-rust">main</span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
async <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">main</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-&gt;</span> <span class="z-meta z-path z-rust">std<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">io<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Result</span><span class="z-punctuation z-definition z-generic z-begin z-rust">&lt;</span><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-punctuation z-section z-group z-end z-rust">)</span><span class="z-punctuation z-definition z-generic z-end z-rust">&gt;</span></span></span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
    <span class="z-meta z-path z-rust">HttpServer<span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">|</span></span></span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">|</span></span> </span><span class="z-meta z-function z-closure z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
        <span class="z-storage z-type z-rust">let</span> auth <span class="z-keyword z-operator z-assignment z-rust">=</span> <span class="z-meta z-path z-rust">GrantsMiddleware<span class="z-punctuation z-accessor z-rust">::</span></span>with_extractor<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>extract</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-terminator z-rust">;</span>
        <span class="z-meta z-path z-rust">App<span class="z-punctuation z-accessor z-rust">::</span></span>new<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
            <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">wrap</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>auth</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
            <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">service</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span>index</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
    </span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
    <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">bind</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>localhost:8081<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-keyword z-operator z-rust">?</span>
    <span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">run</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
    <span class="z-punctuation z-accessor z-dot z-rust">.</span>await
</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>

async <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">extract</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span><span class="z-variable z-parameter z-rust">_req</span><span class="z-punctuation z-separator z-rust">:</span> <span class="z-keyword z-operator z-rust">&amp;</span>ServiceRequest</span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-&gt;</span> <span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Result</span><span class="z-punctuation z-definition z-generic z-begin z-rust">&lt;</span><span class="z-meta z-generic z-rust"><span class="z-support z-type z-rust">Vec</span><span class="z-punctuation z-definition z-generic z-begin z-rust">&lt;</span><span class="z-support z-type z-rust">String</span><span class="z-punctuation z-definition z-generic z-end z-rust">&gt;</span></span>, Error<span class="z-punctuation z-definition z-generic z-end z-rust">&gt;</span></span></span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Here is a place for your code to get user permissions/grants from a request
</span>    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> For example from a token or database
</span>    
    <span class="z-comment z-line z-double-slash z-rust"><span class="z-punctuation z-definition z-comment z-rust">//</span> Stub example
</span>    <span class="z-support z-type z-rust">Ok</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-support z-macro z-rust">vec!</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-constant z-other z-rust">ROLE_ADMIN</span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">to_string</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre>
<p>This approach adds flexibility and allows us to implement authorization regardless of the methods of authentication and storage of user privileges: it can be a <em>JWT token</em>, a <em>database</em>, an <em>intermediate cache</em>, or <em>any other solution</em>.</p>
<p>Then we can place restrictions directly on our resources (via macro):</p>
<pre data-lang="rust" class="language-rust z-code"><code class="language-rust" data-lang="rust"><span class="z-source z-rust"><span class="z-keyword z-other z-rust">use</span> <span class="z-meta z-path z-rust">actix_web_grants<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-path z-rust">proc_macro<span class="z-punctuation z-accessor z-rust">::</span></span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>has_roles</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span><span class="z-punctuation z-terminator z-rust">;</span>

<span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">get</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>/secure<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
<span class="z-meta z-annotation z-rust"><span class="z-punctuation z-definition z-annotation z-rust">#</span><span class="z-punctuation z-section z-group z-begin z-rust">[</span><span class="z-variable z-annotation z-rust">has_roles</span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>ROLE_ADMIN<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span></span></span><span class="z-meta z-annotation z-parameters z-rust"><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span></span><span class="z-punctuation z-section z-group z-end z-rust">]</span></span>
async <span class="z-meta z-function z-rust"><span class="z-meta z-function z-rust"><span class="z-storage z-type z-function z-rust">fn</span> </span><span class="z-entity z-name z-function z-rust">macro_secured</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-begin z-rust">(</span></span><span class="z-meta z-function z-rust"><span class="z-meta z-function z-parameters z-rust"><span class="z-punctuation z-section z-parameters z-end z-rust">)</span></span></span></span><span class="z-meta z-function z-rust"> <span class="z-meta z-function z-return-type z-rust"><span class="z-punctuation z-separator z-rust">-&gt;</span> HttpResponse</span> </span><span class="z-meta z-function z-rust"><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-begin z-rust">{</span>
    <span class="z-meta z-path z-rust">HttpResponse<span class="z-punctuation z-accessor z-rust">::</span></span>Ok<span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span><span class="z-punctuation z-accessor z-dot z-rust">.</span><span class="z-support z-function z-rust">body</span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-begin z-rust">(</span><span class="z-string z-quoted z-double z-rust"><span class="z-punctuation z-definition z-string z-begin z-rust">&quot;</span>ADMIN_RESPONSE<span class="z-punctuation z-definition z-string z-end z-rust">&quot;</span></span></span><span class="z-meta z-group z-rust"><span class="z-punctuation z-section z-group z-end z-rust">)</span></span>
</span><span class="z-meta z-block z-rust"><span class="z-punctuation z-section z-block z-end z-rust">}</span></span></span>
</span></code></pre>
<p>The ability to change to access policy directly in the code is a distinctive part of <em>actix-web-grants</em>, reducing duplication of access objects and providing us with visual information about the required privileges.</p>
<p>For the sake of completeness, minimal examples of applications with an identical usage profile were written and the performance of the authorization process was measured (based on <a rel="noopener" target="_blank" href="https://github.com/wg/wrk">wrk</a>) to satisfy our own interest.</p>
<p>The examples are written with a simplified implementation of the RBAC model for two test cases of authorization: a request to a resource is allowed and denied, in accordance with the presence of the necessary roles. Stubs were used for authentication. All code is available on GitHub: <em><a rel="noopener" target="_blank" href="https://github.com/DDtKey/actix-web-authz-benchmark">actix-web-authz-benchmark</a></em> (more examples can always be found on the pages of these projects).</p>
<p>The benchmark results can be seen in the table:</p>
<div class="table-responsive">
    <table class="table table-bordered">
      <tr>
       <td rowspan="2" align="center">Benchmark</td>
       <td colspan="2" align="center"><strong>casbin-rs</strong></td>
       <td colspan="2" align="center"><strong>actix-web-grants</strong></td>
      </tr>
      <tr>
       <td>Latency</td>
       <td>Req/Sec</td>
       <td>Latency</td>
       <td>Req/Sec</td>
      </tr>
      <tr>
       <td>Allowed Endpoint</td>
       <td>6.18 ms</td>
       <td>16.27k</td>
       <td>4.41 ms</td>
       <td>22.69k</td>
      </tr>
      <tr>
       <td>Denied Endpoint</td>
       <td>6.70 ms</td>
       <td>14.98k</td>
       <td>4.94 ms</td>
       <td>20.23k</td>
      </tr>
    </table>
</div>
<blockquote>
<p><em>rustc: v1.52.0 (stable); CPU: 2,6 GHz 6-Core Intel Core i7; RAM: 16 GB</em></p>
</blockquote>
<p>Thus, we see that <a rel="noopener" target="_blank" href="https://github.com/DDtKey/actix-web-grants">actix-web-grants</a> makes it easier to integrate and administer access policies over endpoints (endpoints), while not inferior in performance compared to <a rel="noopener" target="_blank" href="https://github.com/casbin/casbin-rs">casbin-rs</a>.</p>
<h4 id="post-scriptum">Post Scriptum</h4>
<p>This library does not yet have integrations with many web frameworks in its arsenal, but I have plans to introduce some abstractions and write modules for other frameworks, make some improvements (for example, the ability to inherit roles and support custom types). Any suggestions and contributions will be welcome!</p>

        </section>

        
            <div class="post-tags">
                <nav class="nav tags">
                    <ul class="tags">
                        
                            <li><a href=https://ddtkey.com/tags/rust/>rust</a></li>
                        
                            <li><a href=https://ddtkey.com/tags/authz/>authz</a></li>
                        
                    </ul>
                </nav>
            </div>
        

    </article>
</main>



        
        
    </div>
</body>

</html>
